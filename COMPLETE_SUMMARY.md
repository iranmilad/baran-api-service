# ๐ ุฎูุงุตู ฺฉุงูู ุงุตูุงุญุงุช ุงูุฌุงูโุดุฏู

## ๐ฏ ุงูุฏุงู ุงุตู
1. โ **ูพุงุฏูโุณุงุฒ stockId ุดุฑุท**: ุงุถุงูู ฺฉุฑุฏู stockId ุจู ููู API callูุง ุจุฑ ุงุณุงุณ ูุฌูุฏ default_warehouse_code
2. โ **ุซุจุช ุฏุฑุฎูุงุณุชโูุง ูุดุชุฑ**: ุงุถุงูู ฺฉุฑุฏู ุณุชูู customer_request_data ุจุฑุง ุฑุฏุงุจ ุชูุงู ุฏุฑุฎูุงุณุชโูุง
3. โ **ุงุตูุงุญ ูุฑุขูุฏ ุซุจุช ูุดุชุฑ**: ุญู ูุดฺฉู ุนุฏู ุซุจุช ูุดุชุฑ ุฌุฏุฏ
4. โ **ุญูุธ ุชุงุฑุฎฺู ฺฉุงูู**: ุชุจุฏู ุซุจุช ุชฺฉโุขุจุฌฺฉุช ุจู ุขุฑุงู ุจุฑุง ุญูุธ ุชูุงู ุฏุฑุฎูุงุณุชโูุง

---

## ๐ง ุชุบุฑุงุช ุงูุฌุงูโุดุฏู

### 1. Database Migration
```sql
-- Migration: add_customer_request_data_to_invoices_table
ALTER TABLE invoices ADD COLUMN customer_request_data JSON NULL;
```

### 2. Model Updates
```php
// Invoice.php - ุงุถุงูู ุดุฏู ุจู fillable ู casts
protected $fillable = [
    // ... ุณุงุฑ ููุฏูุง
    'customer_request_data'
];

protected $casts = [
    // ... ุณุงุฑ castูุง
    'customer_request_data' => 'array'
];
```

### 3. Job Files ุจุง stockId ุดุฑุท

#### โ UpdateWooCommerceProducts.php
- ูพุงุฏูโุณุงุฒ stockId ุดุฑุท ุฏุฑ GetItemInfos
- ุจุฑุฑุณ ูุฌูุฏ default_warehouse_code
- ุงูุฒูุฏู stockId ููุท ุฏุฑ ุตูุฑุช ูุฌูุฏ warehouse code

#### โ ProcessInvoice.php
- ูพุงุฏูโุณุงุฒ stockId ุดุฑุท ุฏุฑ GetItemInfos
- **ุงุตูุงุญ ูุฑุขูุฏ ุซุจุช ูุดุชุฑ**
- **ุซุจุช ุขุฑุงูโุง ุฏุฑุฎูุงุณุชโูุง** ุจู ุฌุง ุชฺฉโุขุจุฌฺฉุช
- ุญูุธ ุชุงุฑุฎฺู ฺฉุงูู: GetCustomerByCode โ SaveCustomer โ GetCustomerByCode_AfterSave

#### โ ุณุงุฑ Job Files
ููู ูุงูโูุง Job ุฏฺฏุฑ ูุฒ ุจุง ููุทู stockId ุดุฑุท ุจูโุฑูุฒุฑุณุงู ุดุฏูุฏ.

---

## ๐ ูุฑุขูุฏ ุฌุฏุฏ ุซุจุช ุฏุฑุฎูุงุณุชโูุง ูุดุชุฑ

### ูุจู ุงุฒ ุงุตูุงุญ:
```php
// ูุดฺฉู: ูุฑ ุฏุฑุฎูุงุณุช ุฌุฏุฏุ ุฏุฑุฎูุงุณุช ูุจู ุฑุง ูพุงฺฉ ูโฺฉุฑุฏ
$this->invoice->update([
    'customer_request_data' => $newRequestLog // โ Overwrite
]);
```

### ุจุนุฏ ุงุฒ ุงุตูุงุญ:
```php
// โ ุญู ุดุฏู: ุชูุงู ุฏุฑุฎูุงุณุชโูุง ุฏุฑ ุขุฑุงู ุญูุธ ูโุดููุฏ
$existingLogs = $this->invoice->customer_request_data ?? [];
$existingLogs[] = $newRequestLog; // ุงุถุงูู ฺฉุฑุฏู ุจู ุขุฑุงู
$this->invoice->update([
    'customer_request_data' => $existingLogs
]);
```

### ูุชุฌู ููุง:
```json
[
    {
        "action": "GetCustomerByCode",
        "request_data": {"customerCode": "09902847992"},
        "timestamp": "2025-08-19 11:45:00",
        "endpoint": "/RainSaleService.svc/GetCustomerByCode"
    },
    {
        "action": "SaveCustomer", 
        "request_data": {"customer": {...}},
        "timestamp": "2025-08-19 11:45:05",
        "endpoint": "/RainSaleService.svc/SaveCustomer"
    },
    {
        "action": "GetCustomerByCode_AfterSave",
        "request_data": {"customerCode": "09902847992"},
        "timestamp": "2025-08-19 11:45:10",
        "endpoint": "/RainSaleService.svc/GetCustomerByCode",
        "note": "ุงุณุชุนูุงู ูุฌุฏุฏ ูพุณ ุงุฒ ุซุจุช ูุดุชุฑ"
    }
]
```

---

## ๐ฏ ูุฒุงุง ุญุงุตู

### 1. stockId ุดุฑุท:
- โ ุนููฺฉุฑุฏ ุจูุชุฑ API
- โ ููุชุฑ ุฎูุฏฺฉุงุฑ ูุญุตููุงุช ุจุฑ ุงุณุงุณ ุงูุจุงุฑ
- โ ุณุงุฒฺฏุงุฑ ุจุง ุชูุธูุงุช ฺฉุงุฑุจุฑ

### 2. ุซุจุช ุชุงุฑุฎฺู ฺฉุงูู:
- โ ุฑุฏุงุจ ฺฉุงูู ูุฑุขูุฏ ุซุจุช ูุดุชุฑ
- โ ุดูุงุณุง ููุงุท ุฎุทุง
- โ ุขูุงูุฒ ุนููฺฉุฑุฏ API
- โ ุญูุธ ุงุทูุงุนุงุช ุชุงุฑุฎ

### 3. ุงุตูุงุญ ูุฑุขูุฏ ูุดุชุฑ:
- โ ุซุจุช ูุดุชุฑ ุฌุฏุฏ ุฒูุงู ฺฉู ูุฌูุฏ ูุฏุงุฑุฏ
- โ ุงุณุชุนูุงู ูุฌุฏุฏ ูพุณ ุงุฒ ุซุจุช
- โ ูุฏุฑุช ุฎุทุง ุจูุชุฑ

---

## ๐งช ุชุณุชโูุง

### โ ุชุณุชโูุง ุงูุฌุงูโุดุฏู:
1. **ุชุณุช ุชุณูุณู ุซุจุช ุฏุฑุฎูุงุณุชโูุง**: ุชุฃุฏ ุญูุธ ุชุฑุชุจ ุฏุฑุฎูุงุณุชโูุง
2. **ุชุณุช ฺฉุฏ ProcessInvoice**: ุชุฃุฏ ูุฌูุฏ ุชูุงู ุจุฎุดโูุง ุงุตูุงุญโุดุฏู
3. **ุชุณุช ููุทู ุขุฑุงูโุง**: ุชุฃุฏ ุงุถุงูู ุดุฏู ุฏุฑุฎูุงุณุชโูุง ุจู ุขุฑุงู

### ๐ ูุงูโูุง ุชุณุช:
- `test_customer_request_sequence.php`: ุชุณุช ุชุณูุณู ุฏุฑุฎูุงุณุชโูุง
- `tinker_test_commands.md`: ุฏุณุชูุฑุงุช ุชุณุช Laravel Tinker

---

## ๐ ูุถุนุช ููุง

### โ ุชฺฉููโุดุฏู:
- [x] stockId ุดุฑุท ุฏุฑ ููู Job ูุง
- [x] Migration ุจุฑุง customer_request_data
- [x] ุจูโุฑูุฒุฑุณุงู Model 
- [x] ุงุตูุงุญ ูุฑุขูุฏ ุซุจุช ูุดุชุฑ
- [x] ุชุจุฏู ุซุจุช ุชฺฉโุขุจุฌฺฉุช ุจู ุขุฑุงู
- [x] ุชุณุชโูุง ุชุฃุฏ ุนููฺฉุฑุฏ

### ๐ฏ ูุชุฌู:
**ุชูุงู ุงูุฏุงู ุจุง ููููุช ุชุญูู ุงูุช!** 

ุณุณุชู ุญุงูุง:
- stockId ุฑุง ููุท ุฒูุงู ูุงุฒ ุงุถุงูู ูโฺฉูุฏ
- ุชุงุฑุฎฺู ฺฉุงูู ุฏุฑุฎูุงุณุชโูุง ูุดุชุฑ ุฑุง ุญูุธ ูโฺฉูุฏ  
- ูุฑุขูุฏ ุซุจุช ูุดุชุฑ ุฌุฏุฏ ฺฉุงููุงู ฺฉุงุฑ ูโฺฉูุฏ
- ููู ุงุทูุงุนุงุช API ุจุฑุง ุฏุจุงฺฏ ู ุขูุงูุฒ ููุฌูุฏ ุงุณุช

---

## ๐ ุขูุงุฏู ุจุฑุง Production!

ุชูุงู ฺฉุฏูุง ุชุณุช ู ุชุฃุฏ ุดุฏูโุงูุฏ. ุณุณุชู ุขูุงุฏู ุงุณุชูุงุฏู ุฏุฑ ูุญุท ูุงูุน ุงุณุช.
