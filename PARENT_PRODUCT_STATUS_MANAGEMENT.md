# مدیریت وضعیت محصولات در فرایند درج

## خلاصه تغییرات

✅ **سیستم مدیریت وضعیت محصولات بر اساس نوع**

### 🎯 **هدف**:
- **کالای مادر (Parent Product)**: همیشه **پیش‌نویس (draft)** باقی می‌ماند
- **محصولات ساده (Simple Products)**: به صورت **پیش‌نویس (draft)** درج می‌شوند  
- **واریانت‌ها (Variations)**: به صورت **منتشر شده (publish)** درج می‌شوند

### 🏗️ **منطق پیاده‌سازی**:

```php
// منطق تعیین status
if ($isVariant) {
    if (!empty($parentId)) {
        // واریانت با والد - منتشر می‌شود
        $data['status'] = 'publish';
        $data['type'] = 'variable';
        $data['parent_unique_id'] = $parentId;
    } else {
        // کالای مادر - همیشه پیش‌نویس می‌ماند
        $data['status'] = 'draft';
        $data['type'] = 'variable';
    }
} else {
    // محصول ساده - پیش‌نویس درج می‌شود
    $data['status'] = 'draft';
    $data['type'] = 'simple';
}
```

### 🔄 **فرایند کاری**:

```
1. کالای مادر درج می‌شود → status: draft (همیشه پیش‌نویس می‌ماند)
   ↓
2. واریانت‌ها درج می‌شوند → status: publish (منتشر می‌شوند)
   ↓
3. محصولات ساده درج می‌شوند → status: draft (پیش‌نویس می‌مانند)
```

### 📊 **نتایج مورد انتظار**:

#### ✅ **بعد از تغییرات**:
- **کالای مادر**: `status: draft` (همیشه پیش‌نویس)
- **واریانت‌ها**: `status: publish` (بلافاصله قابل مشاهده)
- **محصولات ساده**: `status: draft` (پیش‌نویس، نیاز به بررسی دستی)

### 🔍 **لاگ‌های مفید**:

#### درج کالای مادر:
```
[INFO] محصول متغیر مادر (parent product) - پیش‌نویس
{
    "barcode": "PRODUCT-MAIN",
    "type": "variable",
    "status": "draft"
}
```

#### درج واریانت:
```
[INFO] محصول متغیر (واریانت) با شناسه یکتای والد - منتشر شده
{
    "barcode": "PRODUCT-XL",
    "parent_unique_id": "PARENT-ID",
    "type": "variable",
    "status": "publish"
}
```

#### درج محصول ساده:
```
[INFO] محصول ساده - پیش‌نویس
{
    "barcode": "SIMPLE-PRODUCT",
    "type": "simple",
    "status": "draft"
}
```

### 🚨 **نکات مهم**:

1. **کالای مادر همیشه پیش‌نویس**: برای کنترل محتوا و بررسی دستی
2. **واریانت‌ها منتشر**: برای نمایش فوری به مشتریان
3. **محصولات ساده پیش‌نویس**: برای بررسی و تأیید قبل از انتشار
4. **مدیریت دستی**: مدیر می‌تواند محصولات مورد نظر را دستی منتشر کند

### 🛠️ **عیب‌یابی**:

#### اگر واریانت‌ها منتشر نمی‌شوند:
1. بررسی parent_unique_id در داده‌های ورودی
2. بررسی لاگ‌های BulkInsertWooCommerceProducts
3. اطمینان از صحت فیلد is_variant و parent_id

#### اگر محصولات ساده یا کالای مادر منتشر می‌شوند:
1. بررسی منطق تشخیص نوع محصول
2. بررسی مقادیر is_variant و parent_id

### 📋 **مزایای جدید**:
- ✅ **کنترل کیفیت**: کالای مادر و محصولات ساده نیاز به بررسی دارند
- ✅ **نمایش سریع واریانت‌ها**: مشتری بلافاصله واریانت‌ها را می‌بیند  
- ✅ **مدیریت محتوا**: امکان ویرایش قبل از انتشار
- ✅ **سادگی**: عدم نیاز به job های پیچیده انتشار خودکار

### 📋 **TODO برای آینده**:
- [ ] اضافه کردن dashboard برای مدیریت دستی وضعیت محصولات
- [ ] ایجاد گزارش آماری از وضعیت محصولات  
- [ ] اضافه کردن bulk action برای انتشار دسته‌ای محصولات
