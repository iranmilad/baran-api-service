<?php

require_once __DIR__ . '/vendor/autoload.php';

/**
 * ØªØ³Øª Ù…Ù†Ø·Ù‚ Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù…Ø­ØµÙˆÙ„Ø§Øª Ø¨Ø± Ø§Ø³Ø§Ø³ item_id
 *
 * Ù…Ù†Ø·Ù‚ Ø¬Ø¯ÛŒØ¯:
 * - Ø§Ú¯Ø± item_id Ù…Ø´Ø§Ø¨Ù‡ Ø¨Ø§Ø´Ø¯ â†’ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø±Ú©ÙˆØ±Ø¯ Ù…ÙˆØ¬ÙˆØ¯
 * - Ø¯Ø± ØºÛŒØ± Ø§ÛŒÙ† ØµÙˆØ±Øª â†’ Ø¯Ø±Ø¬ Ø±Ú©ÙˆØ±Ø¯ Ø¬Ø¯ÛŒØ¯ Ù…Ø³ØªÙ‚Ù„
 */

echo "=== ØªØ³Øª Ù…Ù†Ø·Ù‚ Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ item_id ===\n\n";

echo "ðŸ“‹ Ù…Ù†Ø·Ù‚ Ø¬Ø¯ÛŒØ¯:\n";
echo "1. Ø¬Ø³ØªØ¬Ùˆ Ø¨Ø± Ø§Ø³Ø§Ø³ item_id (Ù†Ù‡ license_id + item_id)\n";
echo "2. Ø§Ú¯Ø± Ù…ÙˆØ¬ÙˆØ¯: Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ\n";
echo "3. Ø§Ú¯Ø± Ø¬Ø¯ÛŒØ¯: Ø§ÛŒØ¬Ø§Ø¯\n\n";

// Ø³Ù†Ø§Ø±ÛŒÙˆÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù
$scenarios = [
    [
        'name' => 'Ø³Ù†Ø§Ø±ÛŒÙˆ 1: Ù…Ø­ØµÙˆÙ„ Ø¬Ø¯ÛŒØ¯',
        'license_id' => 1,
        'item_id' => 'ITEM-001',
        'database_before' => [
            ['license_id' => 2, 'item_id' => 'ITEM-001'],  // Ù…Ø­ØµÙˆÙ„ Ù…ØªÙØ§ÙˆØª Ø§Ø² license Ø¯ÛŒÚ¯Ø±
        ],
        'expected_action' => 'Ø§ÛŒØ¬Ø§Ø¯',
        'explanation' => 'Ù‡Ø± Ù„Ø§ÛŒØ³Ù†Ø³ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ù…Ø­ØµÙˆÙ„ Ø¬Ø¯ÛŒØ¯ Ø¨Ø³Ø§Ø²Ø¯ (item_id Ø±Ø§ Ø¯Ø±ÛŒØ§ÙØª Ù…ÛŒâ€ŒÚ©Ù†Ø¯)'
    ],
    [
        'name' => 'Ø³Ù†Ø§Ø±ÛŒÙˆ 2: Ù…Ø­ØµÙˆÙ„ Ù…ÙˆØ¬ÙˆØ¯ (Ù‡Ù…Ø§Ù† license)',
        'license_id' => 1,
        'item_id' => 'ITEM-001',
        'database_before' => [
            ['license_id' => 1, 'item_id' => 'ITEM-001', 'price' => 100000],
        ],
        'expected_action' => 'Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ',
        'explanation' => 'Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…Ø­ØµÙˆÙ„ Ù…ÙˆØ¬ÙˆØ¯'
    ],
    [
        'name' => 'Ø³Ù†Ø§Ø±ÛŒÙˆ 3: Ù…Ø­ØµÙˆÙ„ Ù…ÙˆØ¬ÙˆØ¯ (license Ù…ØªÙØ§ÙˆØª)',
        'license_id' => 2,
        'item_id' => 'ITEM-001',
        'database_before' => [
            ['license_id' => 1, 'item_id' => 'ITEM-001', 'price' => 100000],
        ],
        'expected_action' => 'Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ',
        'explanation' => 'Ù…Ù†Ø·Ù‚: Ø§Ú¯Ø± item_id ÛŒÚ©Ø³Ø§Ù† = Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ (Ø­ØªÛŒ license Ù…ØªÙØ§ÙˆØª)',
        'warning' => 'ØªÙˆØ¬Ù‡: license_id Ù‡Ù… Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯'
    ],
    [
        'name' => 'Ø³Ù†Ø§Ø±ÛŒÙˆ 4: Ù…Ø­ØµÙˆÙ„Ø§Øª Ù…ØªÙØ§ÙˆØª',
        'license_id' => 1,
        'item_id' => 'ITEM-002',
        'database_before' => [
            ['license_id' => 1, 'item_id' => 'ITEM-001'],
        ],
        'expected_action' => 'Ø§ÛŒØ¬Ø§Ø¯',
        'explanation' => 'item_id Ù…ØªÙØ§ÙˆØª = Ù…Ø­ØµÙˆÙ„ Ø¬Ø¯ÛŒØ¯'
    ]
];

foreach ($scenarios as $index => $scenario) {
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n";
    echo ($index + 1) . ". {$scenario['name']}\n";
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n";

    echo "ðŸ“Š ÙˆØ¶Ø¹ÛŒØª:\n";
    echo "â”œâ”€ License ID: {$scenario['license_id']}\n";
    echo "â”œâ”€ Item ID: {$scenario['item_id']}\n";
    echo "â””â”€ Ù…Ø­ØµÙˆÙ„Ø§Øª Ù…ÙˆØ¬ÙˆØ¯ Ù‚Ø¨Ù„: " . count($scenario['database_before']) . "\n\n";

    echo "ðŸ’¾ Ù¾Ø±Ø³â€ŒÙˆØ¬Ùˆ Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³:\n";
    echo "```sql\n";
    echo "SELECT * FROM products WHERE item_id = '{$scenario['item_id']}';\n";
    echo "```\n\n";

    echo "âœ… Ù†ØªÛŒØ¬Ù‡ Ù…ÙˆØ±Ø¯ Ø§Ù†ØªØ¸Ø§Ø±:\n";
    echo "â”œâ”€ Ø¹Ù…Ù„ÛŒØ§Øª: {$scenario['expected_action']}\n";
    echo "â””â”€ {$scenario['explanation']}\n";

    if (isset($scenario['warning'])) {
        echo "\nâš ï¸  ØªÙˆØ¬Ù‡: {$scenario['warning']}\n";
    }

    echo "\nðŸ“ Ú©Ø¯ PHP:\n";
    echo "```php\n";
    echo "// Ù…Ù†Ø·Ù‚ Ø¬Ø¯ÛŒØ¯:\n";
    echo "\$product = Product::where('item_id', \$itemId)->first();\n\n";

    if ($scenario['expected_action'] === 'Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ') {
        echo "if (\$product) {\n";
        echo "    \$product->update([\n";
        echo "        'license_id' => \$license->id,  // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ license_id\n";
        echo "        'item_name' => \$itemName,\n";
        echo "        'barcode' => \$barcode,\n";
        echo "        'price_amount' => \$priceAmount,\n";
        echo "        'last_sync_at' => now()\n";
        echo "    ]);\n";
        echo "}\n";
    } else {
        echo "if (!\$product) {\n";
        echo "    Product::create([\n";
        echo "        'license_id' => \$license->id,\n";
        echo "        'item_id' => \$itemId,\n";
        echo "        'item_name' => \$itemName,\n";
        echo "        'barcode' => \$barcode,\n";
        echo "        'price_amount' => \$priceAmount,\n";
        echo "        'last_sync_at' => now()\n";
        echo "    ]);\n";
        echo "}\n";
    }
    echo "```\n\n";
}

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n";
echo "ðŸ”‘ ØªÙØ§ÙˆØªâ€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ:\n";
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n";

$comparison = [
    [
        'Ø¬Ù†Ø¨Ù‡' => 'Ù…Ø¹ÛŒØ§Ø± Ø¬Ø³ØªØ¬Ùˆ',
        'Ù‚Ø¨Ù„' => 'license_id + item_id',
        'Ø¨Ø¹Ø¯' => 'ÙÙ‚Ø· item_id'
    ],
    [
        'Ø¬Ù†Ø¨Ù‡' => 'Ù…Ø­ØµÙˆÙ„ Ù…ØªÙØ§ÙˆØª license',
        'Ù‚Ø¨Ù„' => 'Ù…Ø­ØµÙˆÙ„ Ø¬Ø¯ÛŒØ¯ Ø§ÛŒØ¬Ø§Ø¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯',
        'Ø¨Ø¹Ø¯' => 'Ù…Ø­ØµÙˆÙ„ Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯'
    ],
    [
        'Ø¬Ù†Ø¨Ù‡' => 'ØªØ£Ø«ÛŒØ± license_id',
        'Ù‚Ø¨Ù„' => 'ØªØ£Ø«ÛŒØ± Ù†Ù…ÛŒâ€ŒÚ¯Ø°Ø§Ø±Ø¯',
        'Ø¨Ø¹Ø¯' => 'license_id Ø¨Ø±Ø§ÛŒ Ø±Ú©ÙˆØ±Ø¯ Ù…ÙˆØ¬ÙˆØ¯ Ù‡Ù… Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯'
    ],
    [
        'Ø¬Ù†Ø¨Ù‡' => 'Ù…ÙˆØ±Ø¯ Ø§Ø³ØªÙØ§Ø¯Ù‡',
        'Ù‚Ø¨Ù„' => 'Ù…Ø­ØµÙˆÙ„Ø§Øª Ù…Ø³ØªÙ‚Ù„ Ø¨Ø±Ø§ÛŒ Ù‡Ø± license',
        'Ø¨Ø¹Ø¯' => 'Ù…Ø­ØµÙˆÙ„Ø§Øª Ù…Ø´ØªØ±Ú© Ù…ÛŒØ§Ù† licenses'
    ]
];

echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n";
echo "â”‚ Ø¬Ù†Ø¨Ù‡                â”‚ Ù…Ù†Ø·Ù‚ Ù‚Ø¨Ù„ÛŒ           â”‚ Ù…Ù†Ø·Ù‚ Ø¬Ø¯ÛŒØ¯           â”‚\n";
echo "â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\n";

foreach ($comparison as $row) {
    printf("â”‚ %-19s â”‚ %-20s â”‚ %-20s â”‚\n",
        mb_substr($row['Ø¬Ù†Ø¨Ù‡'], 0, 19),
        mb_substr($row['Ù‚Ø¨Ù„'], 0, 20),
        mb_substr($row['Ø¨Ø¹Ø¯'], 0, 20)
    );
}

echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n";

echo "ðŸ“ˆ Ù…Ø«Ø§Ù„ Ø¹Ù…Ù„ÛŒ:\n";
echo "```sql\n";
echo "-- Ù‚Ø¨Ù„:\n";
echo "-- License 1: Product(item_id=ITEM-001, price=100000)\n";
echo "-- License 2: Product(item_id=ITEM-001, price=150000)  -- Ù…Ø­ØµÙˆÙ„ Ø¬Ø¯ÛŒØ¯\n\n";
echo "-- Ø¨Ø¹Ø¯:\n";
echo "-- License 2: Product(item_id=ITEM-001, price=150000)  -- Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ\n";
echo "-- license_id ØªØºÛŒÛŒØ± Ù…ÛŒâ€ŒÚ©Ù†Ø¯: 1 â†’ 2\n";
echo "```\n\n";

echo "âš ï¸  Ù†Ú©Ø§Øª Ù…Ù‡Ù…:\n";
echo "1. âœ… Ø§Ú¯Ø± item_id Ù…Ø´Ø§Ø¨Ù‡ = Ù‡Ù…Ø§Ù† Ø±Ú©ÙˆØ±Ø¯ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯\n";
echo "2. âœ… Ø­ØªÛŒ Ø§Ú¯Ø± license Ù…ØªÙØ§ÙˆØª Ø¨Ø§Ø´Ø¯\n";
echo "3. âœ… license_id Ù‡Ù… Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯\n";
echo "4. âœ… Ø¢Ø®Ø±ÛŒÙ† license_id Ø¨Ø±Ù†Ø¯Ù‡ Ø®ÙˆØ§Ù‡Ø¯ Ø¨ÙˆØ¯\n";
echo "5. âœ… Ø¯Ø± ØµÙˆØ±ØªÛŒ Ú©Ù‡ item_id Ø¬Ø¯ÛŒØ¯ = Ø±Ú©ÙˆØ±Ø¯ Ø¬Ø¯ÛŒØ¯ Ø§ÛŒØ¬Ø§Ø¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯\n\n";

echo "ðŸ§ª ØªØ³Øª SQL:\n";
echo "```sql\n";
echo "-- Ø¨Ø±Ø±Ø³ÛŒ item_id Ù‡Ø§ÛŒ ØªÚ©Ø±Ø§Ø±ÛŒ:\n";
echo "SELECT item_id, COUNT(*) as count FROM products GROUP BY item_id HAVING COUNT(*) > 1;\n\n";
echo "-- Ø¯ÛŒØ¯Ù† license_id Ø¨Ø±Ø§ÛŒ ÛŒÚ© item:\n";
echo "SELECT license_id, item_id, item_name, price_amount FROM products WHERE item_id = 'ITEM-001';\n";
echo "```\n\n";

echo "âœ… ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯!\n";
echo "Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø­ØµÙˆÙ„Ø§Øª Ø­Ø§Ù„Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ item_id (Ù…Ø³ØªÙ‚Ù„) Ø°Ø®ÛŒØ±Ù‡ Ùˆ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯.\n";

?>
