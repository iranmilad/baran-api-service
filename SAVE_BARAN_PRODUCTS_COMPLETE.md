# ุฎูุงุตู ุฐุฎุฑูโุณุงุฒ ุงุทูุงุนุงุช ูุญุตููุงุช ุจุงุฑุงู - ุชฺฉูู ุดุฏู

## โ ฺฉุงุฑ ุงูุฌุงู ุดุฏ

ุงุทูุงุนุงุช ูุญุตููุงุช ุฏุฑุงูุช ุดุฏู ุงุฒ API ุจุงุฑุงู ุญุงูุง **ูุจู ุงุฒ ุจูโุฑูุฒุฑุณุงู ุฏุฑ Tantooo**ุ ุฏุฑ ุฌุฏูู `products` ุฏุชุงุจุณ ุฐุฎุฑู ูโุดูุฏ.

## ๐ ุชุบุฑุงุช ุงุตู

### 1. ูุชุฏ ุฌุฏุฏ: `saveBaranProductsToDatabase`

**ูุงู:** `app/Jobs/Tantooo/ProcessTantoooSyncRequest.php`

```php
protected function saveBaranProductsToDatabase($license, $baranProducts)
{
    // ุฐุฎุฑู ูุฑ ูุญุตูู:
    // 1. ุงฺฏุฑ ููุฌูุฏ: ุจูโุฑูุฒุฑุณุงู
    // 2. ุงฺฏุฑ ุฌุฏุฏ: ุงุฌุงุฏ
    // 3. ุชูุธู last_sync_at
}
```

### 2. ุชูุฏู ูุฑุงุฎูุงู

```php
// ุณุงุจูู ุชุฑุชุจ:
1. ุฏุฑุงูุช ุงุทูุงุนุงุช ุงุฒ ุจุงุฑุงู
2. ุฐุฎุฑู ุงุทูุงุนุงุช ุฏุฑ ุฏุชุงุจุณ โจ (ุฌุฏุฏ)
3. ุจูโุฑูุฒุฑุณุงู ุฏุฑ Tantooo
```

## ๐ ูุฑุขูุฏ ฺฉุงูู

```
ProcessTantoooSyncRequest Job
โ
โโ 1๏ธโฃ  ุฏุฑุงูุช ฺฉุฏูุง ูุญุตููุงุช
โโ 2๏ธโฃ  ุฏุฑุงูุช ุงุทูุงุนุงุช ุงุฒ ุจุงุฑุงู API
โ
โโ 3๏ธโฃ  ุฐุฎุฑูโุณุงุฒ ุฏุฑ ุฏุชุงุจุณ [ุฌุฏุฏ]
โ  โโ โ ุงุฌุงุฏ ูุญุตููุงุช ุฌุฏุฏ
โ  โโ โ ุจูโุฑูุฒุฑุณุงู ูุญุตููุงุช ููุฌูุฏ
โ  โโ โ ุชูุธู last_sync_at
โ  โโ โ ุซุจุช ุฎุทุงูุง
โ
โโ 4๏ธโฃ  ุจูโุฑูุฒุฑุณุงู ุฏุฑ Tantooo
   โโ ููุฌูุฏ
   โโ ููุช
   โโ ูุงู ูุญุตูู
```

## ๐ ูุชุงุฌ ุฐุฎุฑูโุณุงุฒ

```php
[
    'success' => true,
    'data' => [
        'saved_count' => 50,         // ูุญุตููุงุช ุฌุฏุฏ
        'updated_count' => 150,      // ูุญุตููุงุช ุจูโุฑูุฒุฑุณุงู ุดุฏู
        'total_processed' => 200,    // ฺฉู ูุญุตููุงุช
        'errors' => [                // ุฎุทุงูุง ุงุฌุงุฏ ุดุฏู
            ['barcode' => 'xxx', 'message' => 'ุฎุทุง'],
            // ...
        ]
    ],
    'message' => 'ูุญุตููุงุช ุจุง ููููุช ุฐุฎุฑู ุดุฏูุฏ (50 ุฌุฏุฏุ 150 ุจูโุฑูุฒุฑุณุงู ุดุฏู)'
]
```

## ๐ ูุงูโูุง ูุฑุชุจุท

| ูุงู | ููุน | ุชูุถุญ |
|------|------|-------|
| `app/Jobs/Tantooo/ProcessTantoooSyncRequest.php` | ุงุตูุงุญ | ูุชุฏ ุฌุฏุฏ `saveBaranProductsToDatabase` |
| `app/Models/Product.php` | (ููุฌูุฏ) | ูุฏู ูุญุตูู |
| `database/migrations/2024_03_20_000001_create_products_table.php` | (ููุฌูุฏ) | ุณุงุฎุชุงุฑ ุฌุฏูู products |
| `test_save_baran_products.php` | ุชุณุช | ุชุณุช ุฐุฎุฑูโุณุงุฒ |
| `BARAN_PRODUCTS_DATABASE_SAVE.md` | ูุณุชูุฏุงุช | ูุณุชูุฏุงุช ฺฉุงูู |

## ๐ฏ ูุฒุงุง

| ูุฒุช | ุชูุถุญ |
|------|-------|
| ๐ **ุชุงุฑุฎฺู** | ุซุจุช ุชุบุฑุงุช ููุช ู ููุฌูุฏ |
| โก **ุณุฑุนุช** | ุฏุณุชุฑุณ ุณุฑุน ุจุฏูู API |
| ๐ **ุขููุงู** | ุนููฺฉุฑุฏ ุจุฏูู ุงุชุตุงู |
| ๐ **ุฑุฏุงุจ** | ุฏุงูุณุชู ุฒูุงู ุขุฎุฑู ููฺฏุงูโุณุงุฒ |
| ๐ **ููุงุณู** | ููุงุณู ูุจู ู ุจุนุฏ |
| ๐ **ุงุญุตุงุฆุงุช** | ุชุญูู ุฑููุฏ ุชุบุฑุงุช |

## ๐๏ธ ุณุงุฎุชุงุฑ ุฐุฎุฑูโุณุงุฒ

### ุณุชููโูุง ุฌุฏูู products:

```sql
CREATE TABLE products (
    id BIGINT PRIMARY KEY,
    license_id BIGINT FOREIGN KEY,
    item_id VARCHAR(100) INDEX,        -- ุดูุงุณู ูุญุตูู
    item_name VARCHAR(255),             -- ูุงู ูุญุตูู
    barcode VARCHAR(255) UNIQUE,        -- ฺฉุฏ ุจุงุฑฺฉุฏ
    price_amount BIGINT DEFAULT 0,      -- ููุช
    price_after_discount BIGINT DEFAULT 0, -- ููุช ุจุง ุชุฎูู
    total_count INT DEFAULT 0,          -- ููุฌูุฏ
    stock_id VARCHAR(255) NULLABLE,     -- ุงูุจุงุฑ
    department_name VARCHAR(255) NULLABLE, -- ุฏุณุชูโุจูุฏ
    parent_id VARCHAR(100) INDEX,       -- ูุงูุฏ (ูุงุฑุงูุช)
    is_variant BOOLEAN DEFAULT FALSE,   -- ุขุง ูุงุฑุงูุช
    variant_data JSON NULLABLE,         -- ุงุทูุงุนุงุช ูุงุฑุงูุช
    last_sync_at DATETIME NULLABLE,     -- ุขุฎุฑู ููฺฏุงูโุณุงุฒ
    created_at DATETIME,
    updated_at DATETIME
)
```

## ๐ ุจุฑุฑุณ ุฏุงุฏูโูุง

### ูุซุงู SQL:
```sql
-- ุชูุงู ูุญุตููุงุช ฺฉุงุฑุจุฑ:
SELECT * FROM products 
WHERE license_id = 123 
ORDER BY last_sync_at DESC;

-- ูุญุตููุงุช ุฌุฏุฏ ุงูุฑูุฒ:
SELECT * FROM products 
WHERE license_id = 123 
AND DATE(created_at) = CURDATE();

-- ูุญุตููุงุช ุจูโุฑูุฒุฑุณุงู ุดุฏู:
SELECT * FROM products 
WHERE license_id = 123 
AND DATE(updated_at) = CURDATE()
AND DATE(created_at) != CURDATE();
```

## ๐ ูุงฺฏโูุง ุณุณุชู

### ููููู ูุงฺฏโูุง:

```
[INFO] ุดุฑูุน ุฐุฎุฑูโุณุงุฒ ุงุทูุงุนุงุช ูุญุตููุงุช ุจุงุฑุงู
{
    license_id: 123,
    total_products: 200
}

[DEBUG] ูุญุตูู ุฌุฏุฏ ุฐุฎุฑู ุดุฏ
{
    item_id: '2e0f60f7-e40e-4e7c-8e82-00624bc154e1',
    barcode: '123456789012',
    action: 'created'
}

[DEBUG] ูุญุตูู ุจูโุฑูุฒุฑุณุงู ุดุฏ
{
    item_id: '3f1g71g8-f51f-5f8d-9f93-11735cd265f2',
    barcode: '987654321098',
    action: 'updated'
}

[INFO] ุชฺฉูู ุฐุฎุฑูโุณุงุฒ ูุญุตููุงุช ุจุงุฑุงู
{
    license_id: 123,
    total_products: 200,
    saved_count: 50,
    updated_count: 150,
    error_count: 0
}
```

## โจ ูฺฉุงุช ููู

- โ ูุฑ ูุญุตูู ุจุฑ ุงุณุงุณ `license_id + item_id` ููุญุตุฑ ุงุณุช
- โ `last_sync_at` ุจุฑุง ูุฑ ุจูโุฑูุฒุฑุณุงู ุชูุธู ูโุดูุฏ
- โ ูุญุตููุงุช ุฌุฏุฏ ุจุง `is_variant = false` ุงุฌุงุฏ ูโุดููุฏ
- โ ุชูุงู ุฎุทุงูุง ุซุจุช ู ูพฺฏุฑ ูโุดููุฏ
- โ ุนููุงุช ุงุฏุงูู ูโุงุจุฏ ุญุช ุจุง ุฎุทุงูุง ุฌุฒุฆ
- โ ุงุทูุงุนุงุช ูุจู ุงุฒ ุจูโุฑูุฒุฑุณุงู ูุญููุธ ูโุดูุฏ

## ๐งช ุชุณุช

ุจุฑุง ุจุฑุฑุณ ุงุทูุงุนุงุช ุฐุฎุฑู ุดุฏู:

```bash
php test_save_baran_products.php
```

## ๐ ูุณุชูุฏุงุช

ุจุฑุง ุงุทูุงุนุงุช ฺฉุงูู:

```
BARAN_PRODUCTS_DATABASE_SAVE.md
```

## ๐ ุงุฑุชุจุงุท ุจุง ุจูู ุณุณุชู

```
Baran API
    โ
ProcessTantoooSyncRequest Job
    โ
saveBaranProductsToDatabase() โจ
    โ
Database (products table)
    โ
processAndUpdateProductsFromBaran()
    โ
Tantooo API
```

---

**ูุถุนุช:** โ ุชฺฉูู ุดุฏู
**ุชุงุฑุฎ:** ฑธ ููุฑ ฑดฐด
**ูุถุนุช ุฎุทุงูุง:** โ ุจุฏูู ุฎุทุง
