# ๐ ุงุตูุงุญ ProcessInvoice ุจุฑุง ุฏุฑุงูุช ฺฉุงูู ุณูุงุฑุด ุงุฒ WooCommerce

## ๐ฏ ูุฏู:
ูุจู ุงุฒ ูพุฑุฏุงุฒุด ูุงฺฉุชูุฑุ ุงุจุชุฏุง ุงุทูุงุนุงุช ฺฉุงูู ุณูุงุฑุด ุงุฒ WooCommerce API ุฏุฑุงูุช ุดุฏู ู ุฏุฑ ุณุชูู `order_data` ุฐุฎุฑู ุดูุฏ.

## ๐ง ุชุบุฑุงุช ุงูุฌุงูโุดุฏู:

### 1. ุงุถุงูู ุดุฏู ุชุงุจุน `fetchCompleteOrderFromWooCommerce()`
```php
private function fetchCompleteOrderFromWooCommerce()
{
    // ุฏุฑุงูุช ุณูุงุฑุด ฺฉุงูู ุงุฒ WooCommerce API
    // ุฐุฎุฑู ุฏุฑ order_data 
    // ุจูโุฑูุฒุฑุณุงู customer_mobile
}
```

### 2. ุงุถุงูู ุดุฏู ุชุงุจุน `processWooCommerceOrderData()`
```php
private function processWooCommerceOrderData($wooOrderData)
{
    // ุชุจุฏู ุฏุงุฏูโูุง ุฎุงู WooCommerce ุจู ูุฑูุช ุงุณุชุงูุฏุงุฑุฏ
    // ุงุณุชุฎุฑุงุฌ items ุจุง unique_id ุงุฒ meta_data
    // ูพุฑุฏุงุฒุด ุงุทูุงุนุงุช ูุดุชุฑ
    // ุณุงุฒูุงูุฏู ุฏุงุฏูโูุง ุณูุงุฑุด
}
```

### 3. ุงุถุงูู ุดุฏู ุชุงุจุน `extractMobileFromOrderData()`
```php
private function extractMobileFromOrderData($orderData)
{
    // ุงุณุชุฎุฑุงุฌ ู ุงุณุชุงูุฏุงุฑุฏ ฺฉุฑุฏู ุดูุงุฑู ููุจุงู
}
```

## ๐ ูุฑุขูุฏ ุฌุฏุฏ:

### ูุฑุญูู 1: ุฏุฑุงูุช ุงุฒ WooCommerce
```
Invoice Job ุดุฑูุน ูโุดูุฏ
    โ
ุฏุฑุงูุช ุณูุงุฑุด ฺฉุงูู ุงุฒ WooCommerce API
    โ
ูพุฑุฏุงุฒุด ู ุชุจุฏู ุฏุงุฏูโูุง
    โ
ุฐุฎุฑู ุฏุฑ order_data
    โ
ุงุฏุงูู ูพุฑุฏุงุฒุด ูุนููู
```

### ูุฑุญูู 2: ูุฒุงุง ุญุงุตู
- โ **ุงุทูุงุนุงุช ฺฉุงูู**: ุฏุฑุงูุช ุชูุงู ุฌุฒุฆุงุช ุณูุงุฑุด
- โ **unique_id ุตุญุญ**: ุงุณุชุฎุฑุงุฌ ุงุฒ meta_data ูุญุตููุงุช
- โ **ุงุทูุงุนุงุช ุจูโุฑูุฒ**: ุขุฎุฑู ูุถุนุช ุณูุงุฑุด ุงุฒ WooCommerce
- โ **ุฌุฒุฆุงุช ฺฉุงูู ูุดุชุฑ**: ุขุฏุฑุณุ ุชูููุ ุงูู
- โ **ุงุทูุงุนุงุช ูพุฑุฏุงุฎุช**: ุฑูุด ูพุฑุฏุงุฎุชุ ูุจุงูุบ ุฏูู

## ๐ ุงุณุชุฎุฑุงุฌ ุฏุงุฏูโูุง:

### Items (ูุญุตููุงุช):
```php
// ุงุฒ line_items WooCommerce
foreach ($wooOrderData['line_items'] as $lineItem) {
    // ุงุณุชุฎุฑุงุฌ unique_id ุงุฒ meta_data
    foreach ($lineItem['meta_data'] as $meta) {
        if ($meta['key'] === '_bim_unique_id') {
            $uniqueId = $meta['value'];
        }
    }
}
```

### Customer (ูุดุชุฑ):
```php
// ุงุฒ billing ู shipping WooCommerce
$customer = [
    'first_name' => $wooOrderData['billing']['first_name'],
    'mobile' => $wooOrderData['billing']['phone'],
    'address' => $wooOrderData['billing']['address_1'],
    // ...
];
```

## ๐ ุณุงุฎุชุงุฑ ููุง order_data:

```json
{
    "items": [
        {
            "unique_id": "4b51d99a-8775-4873-b0f7-3a7d7b4e23eb",
            "sku": "46861",
            "quantity": 2,
            "price": 13000000,
            "name": "ุดูุนุฏุงู ูุงูู ุจุฒุฑฺฏ ุจ ุฑูฺฏ",
            "total": 26000000
        }
    ],
    "customer": {
        "first_name": "ุชุจุณู",
        "last_name": "ุงูุฎุงู",
        "mobile": "09902847992",
        "address": {...}
    },
    "payment_method": "WC_AsanPardakht",
    "total": "51200000",
    "shipping_total": "2200000",
    "status": "processing",
    "woo_raw_data": {...}
}
```

## ๐ง ูุฏุฑุช ุฎุทุง:

### ุฏุฑ ุตูุฑุช ุนุฏู ุฏุณุชุฑุณ ุจู WooCommerce:
- โ ูุงฺฏ warning
- โ ุงุฏุงูู ุจุง ุฏุงุฏูโูุง ููุฌูุฏ
- โ ุนุฏู ูุชููู ุดุฏู ูุฑุขูุฏ

### ุฏุฑ ุตูุฑุช ุฎุทุง ุฏุฑ API:
- โ ูุงฺฏ ุฎุทุง ุจุง ุฌุฒุฆุงุช
- โ ุงุฏุงูู ูพุฑุฏุงุฒุด ุจุง ุฏุงุฏูโูุง ุงููู
- โ ุญูุธ ูพุงุฏุงุฑ ุณุณุชู

## ๐ฏ ูุชุฌู:
ุญุงูุง ูุฑ ูุงฺฉุชูุฑ ูุจู ุงุฒ ูพุฑุฏุงุฒุดุ ุงุทูุงุนุงุช ฺฉุงูู ู ุจูโุฑูุฒ ุณูุงุฑุด ุฑุง ุงุฒ WooCommerce ุฏุฑุงูุช ูโฺฉูุฏ ู ุจุฑ ุงุณุงุณ ุขู ูพุฑุฏุงุฒุด ุงูุฌุงู ูโุฏูุฏ.

## ๐ ุขูุงุฏู ุจุฑุง ุชุณุช:
ูุงฺฉุชูุฑ ุฌุฏุฏ ุงุฑุณุงู ฺฉูุฏ ุชุง ูุฑุขูุฏ ุฌุฏุฏ ุงุฌุฑุง ุดูุฏ.
